var ldcvmgr;function import$(r,e){var t,n={}.hasOwnProperty;for(t in e)n.call(e,t)&&(r[t]=e[t]);return r}(ldcvmgr=function(r){var e,o=this;return this.opt=r=null==r?{}:r,this.evtHandler={},this.path=r.path||"/modules/cover","string"==typeof this.path&&(this.path=this.path.replace(/\/$/,"")),this.loader=(e=r.loader)?e:new ldloader({className:"ldld full",autoZ:!0}),this.mgr=r.manager||null,this.blocks={},this.covers={},this.workers={},this.errorCover=r.errorCover||"error",this.errorHandling=!1,this.prepareProxy=proxise(function(r){}),r.zmgr&&this.zmgr(r.zmgr),this.baseZ=r.baseZ||3e3,r.autoInit&&this.init(),block.i18n.module&&block.i18n.module.on("languageChanged",function(){var r,e,t,n=[];for(r in e=o.blocks)t=e[r],n.push(t.transform("i18n"));return n}),this}).prototype=import$(Object.create(Object.prototype),{on:function(r,e){var t;return((t=this.evtHandler)[r]||(t[r]=[])).push(e)},fire:function(r){for(var e,t,n,o,i=[],s=[],c=1,a=arguments.length;c<a;++c)s.push(arguments[c]);for(e=s,c=0,n=(t=this.evtHandler[r]||[]).length;c<n;++c)o=t[c],i.push(o.apply(this,e));return i},zmgr:function(r){return null!=r?this._zmgr=r:this._zmgr},error:function(r,e,t){if(null==r&&(r=""),null==e&&(e={}),null==t&&(t={}),console.error(e),"error"===r||r===this.errorCover||r===this._id(this.errorCover))return alert("something is wrong; please reload and try again"),new Promise(function(r,e){});throw this.errorHandling=!0,this.toggle(this.errorCover||"error",!0,{err:e,param:t}),e},_id:function(r){return"object"==typeof r?this.mgr.id(r):r},prepare:function(r){var t=this,n=this._id(r);return this.covers[n]?Promise.resolve():this.workers[n]?this.prepareProxy(n):(this.errorHandling?(this.loader.on(),this.errorHandling=!1):this.loader.on(1e3),("object"==typeof r?this.workers[n]=this.mgr.get(r).then(function(r){return r.create()}).then(function(r){return r.attach({root:document.body,autoTransform:null,data:{zmgr:t._zmgr,baseZ:t.baseZ}}).then(function(){return t.blocks[n]=r,t.covers[n]=r.interface(),r.dom()})}):(r=document.querySelector(".ldcvmgr[data-name='"+n+"']"))?Promise.resolve(r):(r="function"==typeof this.path?this.path(n):this.path+"/"+n+".html",this.workers[n]=fetch(r).then(function(r){return r&&r.ok?r.text():Promise.reject(new Error("[ldcvmgr] cover '"+(n||"<no-name>")+"' load failed."))}).then(function(r){return new block.class({manager:t.mgr,code:r}).create({root:document.body}).then(function(r){var e;return(e=(t.blocks[n]=r).interface())&&(t.covers[n]=e),r.dom()})}))).finally(function(){return t.loader.cancel(!1)}).then(function(r){var e;return t.covers[n]||(t.covers[n]=new ldcover({root:r,lock:"true"===r.getAttribute("data-lock"),zmgr:t._zmgr,baseZ:t.baseZ})),t.prepareProxy.resolve(),r=(e=t.workers)[n],delete e[n],r}).catch(function(r){throw t.prepareProxy.reject(r),delete t.workers[n],r}))},purge:function(r){var e,t=this._id(r);return null!=t?(r=(e=this.covers)[t],delete e[t],r):this.covers={}},lock:function(r,e){var t=this,n=this._id(r);return Promise.reject(new Error).then(function(){return t.covers[n].lock()}).then(function(){return t.covers[n].toggle(!0,e)}).catch(function(r){return t.error(n,r,e)})},toggle:function(r,e,t){var n=this,o=this._id(r);return this.prepare(r).then(function(){return n.covers[o].toggle(e,t)}).then(function(){return n.fire(n.covers[o].isOn()?"on":"off",{node:n.covers[o],param:t,name:o})}).catch(function(r){return n.error(o,r,t)})},getcover:function(r){var e=this,t=this._id(r);return this.prepare(r).then(function(){return e.covers[t]})},getdom:function(r){var e=this,t=this._id(r);return this.prepare(r).then(function(){return e.covers[t].root()})},isOn:function(r){r=this._id(r);return this.covers[r]&&this.covers[r].isOn()},set:function(r,e){var t=this,n=this._id(r);return this.prepare(r).then(function(){return t.covers[n].set(e)})},get:function(r,e){var t=this,n=this._id(r);return this.prepare(r).then(function(){return t.fire("on",{node:t.covers[n],param:e,name:n}),t.covers[n].get(e)}).catch(function(r){return t.error(n,r,e)})},init:function(r){var t=this;return ld$.find(r||document.body,".ldcvmgr").map(function(r){var e;if((e=r.getAttribute("data-name"))&&!t.covers[e])return t.covers[e]=new ldcover({root:r,lock:"true"===r.getAttribute("data-lock"),zmgr:t._zmgr,baseZ:t.baseZ})}),document.body.addEventListener("click",function(r){var e;if((r=ld$.parent(r.target,"[data-ldcvmgr-toggle]"))&&(e=r.getAttribute("data-ldcvmgr-toggle")))return t.toggle(/:/.exec(e)?t.mgr.id2obj(e):e)})}}),"undefined"!=typeof module&&null!==module?module.exports=ldcvmgr:"undefined"!=typeof window&&null!==window&&(window.ldcvmgr=ldcvmgr);
