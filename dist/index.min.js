var ldcvmgr;function import$(r,t){var e,n={}.hasOwnProperty;for(e in t)n.call(t,e)&&(r[e]=t[e]);return r}(ldcvmgr=function(r){return this.opt=r=null==r?{}:r,this.evtHandler={},this.path=r.path||"/modules/cover","string"==typeof this.path&&(this.path=this.path.replace(/\/$/,"")),this.loader=(r=r.loader)?r:new ldloader({className:"ldld full",autoZ:!0}),this.covers={},this.workers={},this.errorHandling=!1,this.prepareProxy=proxise(function(r){}),this.init(),this}).prototype=import$(Object.create(Object.prototype),{on:function(r,t){var e;return((e=this.evtHandler)[r]||(e[r]=[])).push(t)},fire:function(r){for(var t,e,n,o,i=[],a=[],c=1,s=arguments.length;c<s;++c)a.push(arguments[c]);for(t=a,c=0,n=(e=this.evtHandler[r]||[]).length;c<n;++c)o=e[c],i.push(o.apply(this,t));return i},error:function(r,t){return null==t&&(t={}),"error"===(r=null==r?"":r)?alert("something is wrong; please reload and try again"):(this.errorHandling=!0,this.toggle("error")),console.log(t.message||t)},prepare:function(e){var r,n=this;return this.covers[e]?Promise.resolve():this.workers[e]?this.prepareProxy(e):(this.errorHandling?(this.loader.on(),this.errorHandling=!1):this.loader.on(1e3),((r=document.querySelector(".ldcvmgr[data-name="+e+"]"))?Promise.resolve(r):(r="function"==typeof this.path?this.path(e):this.path+"/"+e+".html",this.workers[e]=fetch(r).then(function(r){if(!r||!r.ok)throw new Error("modal '"+(e||"<no-name>")+"' load failed.");return r.text()}).then(function(r){var t;return document.body.appendChild(t=ld$.create({name:"div"})),t.innerHTML=r,ld$.find(t,"script").map(function(r){var t=ld$.create({name:"script",attr:{type:"text/javascript"}});return t.text=r.textContent,r.parentNode.replaceChild(t,r)}),t.querySelector(".ldcv")}))).finally(function(){return n.loader.cancel(!1)}).then(function(r){var t;return n.covers[e]=new ldcover({root:r,lock:"true"===r.getAttribute("data-lock")}),n.prepareProxy.resolve(),r=(t=n.workers)[e],delete t[e],r}).catch(function(r){throw n.prepareProxy.reject(r),delete n.workers[e],r}))},purge:function(r){var t,e;return null!=r?(e=(t=this.covers)[r],delete t[r],e):this.covers={}},lock:function(t,r){var e=this;return this.prepare(t).then(function(){return e.covers[t].lock()}).then(function(){return e.covers[t].toggle(!0)}).catch(function(r){return e.error(t,r)})},toggle:function(t,r,e){var n=this;return this.prepare(t).then(function(){return n.covers[t].toggle(r)}).then(function(){return n.fire(n.covers[t].isOn()?"on":"off",{node:n.covers[t],param:e,name:t})}).catch(function(r){return n.error(t,r)})},getcover:function(r){var t=this;return this.prepare(r).then(function(){return t.covers[r]})},getdom:function(r){var t=this;return this.prepare(r).then(function(){return t.covers[r].root()})},isOn:function(r){return this.covers[r]&&this.covers[r].isOn()},set:function(r,t){var e=this;return this.prepare(r).then(function(){return e.covers[r].set(t)})},get:function(t,r){var e=this;return this.prepare(t).then(function(){return e.fire("on",{node:e.covers[t],param:r,name:t})}).then(function(){return e.covers[t].get()}).catch(function(r){return e.error(t,r)})},init:function(){var e=this;return ld$.find(".ldcvmgr").map(function(r){var t;if((t=r.getAttribute("data-name"))&&!e.covers[t])return e.covers[t]=new ldcover({root:r,lock:"true"===r.getAttribute("data-lock")})}),ld$.find("[data-ldcv-toggle]").map(function(r){var t;if(t=r.getAttribute("data-ldcv-toggle"))return r.addEventListener("click",function(){return e.toggle(t)})})}}),"undefined"!=typeof module&&null!==module?module.exports=ldcvmgr:"undefined"!=typeof window&&null!==window&&(window.ldcvmgr=ldcvmgr);
