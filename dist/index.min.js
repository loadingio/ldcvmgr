var ldcvmgr;function import$(r,t){var e,n={}.hasOwnProperty;for(e in t)n.call(t,e)&&(r[e]=t[e]);return r}(ldcvmgr=function(r){var t;return this.opt=r=null==r?{}:r,this.evtHandler={},this.path=r.path||"/modules/cover","string"==typeof this.path&&(this.path=this.path.replace(/\/$/,"")),this.loader=(t=r.loader)?t:new ldloader({className:"ldld full",autoZ:!0}),this.mgr=r.manager||null,this.covers={},this.workers={},this.errorCover=r.errorCover||"error",this.errorHandling=!1,this.prepareProxy=proxise(function(r){}),r.autoInit&&this.init(),this}).prototype=import$(Object.create(Object.prototype),{on:function(r,t){var e;return((e=this.evtHandler)[r]||(e[r]=[])).push(t)},fire:function(r){for(var t,e,n,o,i=[],c=[],a=1,s=arguments.length;a<s;++a)c.push(arguments[a]);for(t=c,a=0,n=(e=this.evtHandler[r]||[]).length;a<n;++a)o=e[a],i.push(o.apply(this,t));return i},error:function(r,t,e){return null==t&&(t={}),null==e&&(e={}),"error"===(r=null==r?"":r)||r===this.errorCover?alert("something is wrong; please reload and try again"):(this.errorHandling=!0,this.toggle(this.errorCover||"error",!0,{err:t,param:e})),console.log(t.message||t)},_id:function(r){return"object"==typeof r?this.mgr.id(r):r},prepare:function(r){var e=this,n=this._id(r);return this.covers[n]?Promise.resolve():this.workers[n]?this.prepareProxy(n):(this.errorHandling?(this.loader.on(),this.errorHandling=!1):this.loader.on(1e3),("object"==typeof r?this.workers[n]=this.mgr.get(r).then(function(r){return r.create()}).then(function(r){return r.attach({root:document.body}).then(function(){return e.covers[n]=r.interface(),r.dom()})}):(r=document.querySelector(".ldcvmgr[data-name='"+n+"']"))?Promise.resolve(r):(r="function"==typeof this.path?this.path(n):this.path+"/"+n+".html",this.workers[n]=fetch(r).then(function(r){if(!r||!r.ok)throw new Error("modal '"+(n||"<no-name>")+"' load failed.");return r.text()}).then(function(r){var t;return document.body.appendChild(t=ld$.create({name:"div"})),t.innerHTML=r,ld$.find(t,"script").map(function(r){var t=ld$.create({name:"script",attr:{type:"text/javascript"}});return t.text=r.textContent,r.parentNode.replaceChild(t,r)}),t.querySelector(".ldcv")}))).finally(function(){return e.loader.cancel(!1)}).then(function(r){var t;return e.covers[n]||(e.covers[n]=new ldcover({root:r,lock:"true"===r.getAttribute("data-lock")})),e.prepareProxy.resolve(),r=(t=e.workers)[n],delete t[n],r}).catch(function(r){throw e.prepareProxy.reject(r),delete e.workers[n],r}))},purge:function(r){var t,e=this._id(r);return null!=e?(r=(t=this.covers)[e],delete t[e],r):this.covers={}},lock:function(r,t){var e=this,n=this._id(r);return this.prepare(r).then(function(){return e.covers[n].lock()}).then(function(){return e.covers[n].toggle(!0,t)}).catch(function(r){return e.error(n,r,t)})},toggle:function(r,t,e){var n=this,o=this._id(r);return this.prepare(r).then(function(){return n.covers[o].toggle(t,e)}).then(function(){return n.fire(n.covers[o].isOn()?"on":"off",{node:n.covers[o],param:e,name:o})}).catch(function(r){return n.error(o,r,e)})},getcover:function(r){var t=this,e=this._id(r);return this.prepare(r).then(function(){return t.covers[e]})},getdom:function(r){var t=this,e=this._id(r);return this.prepare(r).then(function(){return t.covers[e].root()})},isOn:function(r){r=this._id(r);return this.covers[r]&&this.covers[r].isOn()},set:function(r,t){var e=this,n=this._id(r);return this.prepare(r).then(function(){return e.covers[n].set(t)})},get:function(r,t){var e=this,n=this._id(r);return this.prepare(r).then(function(){return e.fire("on",{node:e.covers[n],param:t,name:n}),e.covers[n].get(t)}).catch(function(r){return e.error(n,r,t)})},init:function(r){var e=this;return ld$.find(r||document.body,".ldcvmgr").map(function(r){var t;if((t=r.getAttribute("data-name"))&&!e.covers[t])return e.covers[t]=new ldcover({root:r,lock:"true"===r.getAttribute("data-lock")})}),document.body.addEventListener("click",function(r){var t;if((r=ld$.parent(r.target,"[data-ldcvmgr-toggle]"))&&(t=r.getAttribute("data-ldcvmgr-toggle")))return e.toggle(/:/.exec(t)?e.mgr.id2obj(t):t)})}}),"undefined"!=typeof module&&null!==module?module.exports=ldcvmgr:"undefined"!=typeof window&&null!==window&&(window.ldcvmgr=ldcvmgr);
